{{ define "public/index.html" }}
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>博客</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="/static/iconfont/iconfont.css">
<style></style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="/">我的博客</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu"><span class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="navMenu">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" href="/"><i class="bi bi-house me-1"></i>首页</a></li>
        <li class="nav-item"><a class="nav-link" href="/archive"><i class="bi bi-card-list me-1"></i>归档</a></li>
        <li class="nav-item"><a class="nav-link" href="/rss.xml"><i class="bi bi-rss me-1"></i>RSS</a></li>
        <li class="nav-item"><a class="nav-link" href="/sitemap.xml"><i class="bi bi-diagram-3 me-1"></i>Sitemap</a></li>
      </ul>
    </div>
  </div>
</nav>
<header class="bg-light py-5 border-bottom">
  <div class="container">
    <h1 class="display-5">我的博客</h1>
    <p class="text-muted">分享技术与生活的点滴</p>
  </div>
</header>
<!-- 轮播图已取消 -->
<main class="container py-4">
  <div class="row">
    <div class="col-lg-8">
      <div class="row">
        {{ range .posts }}
        <div class="col-md-6 mb-4">
          <div class="card h-100 position-relative">
            {{ if .CoverURL }}<img src="{{ .CoverURL }}" class="card-img-top" alt="">{{ end }}
            <div class="card-body">
              <h5 class="card-title">{{ .Title }}</h5>
              <p class="card-text">{{ .Summary }}</p>
              {{ if .Category }}<div class="mb-2"><a class="badge bg-info text-dark text-decoration-none" href="/categories/{{ .Category.Slug }}">{{ .Category.Title }}</a></div>{{ end }}
              <div>
                {{ range .Tags }}<span class="badge bg-secondary">{{ .Name }}</span> {{ end }}
              </div>
              <a href="/post/{{ .Slug }}" class="stretched-link" aria-label="查看详情"></a>
            </div>
          </div>
        </div>
        {{ end }}
      </div>
      <nav aria-label="分页" class="mt-3">
        <ul class="pagination">
          <li class="page-item {{ if le .page 1 }}disabled{{ end }}"><a class="page-link" href="?page={{ .prevPage }}&size={{ .size }}">上一页</a></li>
          <li class="page-item disabled"><span class="page-link">第 {{ .page }} 页 / 共 {{ .pages }} 页</span></li>
          <li class="page-item {{ if ge .page .pages }}disabled{{ end }}"><a class="page-link" href="?page={{ .nextPage }}&size={{ .size }}">下一页</a></li>
        </ul>
      </nav>
    </div>
    <aside class="col-lg-4">
      <div class="card mb-3">
        <div class="card-header">标签</div>
        <div class="card-body">
          {{ range .tags }}
          <a href="/tags/{{ .Name }}" class="badge bg-info text-dark text-decoration-none me-1 mb-1"><i class="bi bi-globe me-1"></i>{{ .Name }}</a>
          {{ end }}
        </div>
      </div>
      <div class="card mb-3">
        <div class="card-header">分类</div>
        <ul class="list-group list-group-flush">
          {{ range .categories }}
          <li class="list-group-item"><a href="/categories/{{ .Slug }}">{{ .Title }}</a></li>
          {{ end }}
        </ul>
      </div>
      <div class="card mb-3">
        <div class="card-header">本月日历</div>
        <div class="card-body" id="calendar"></div>
      </div>
      <div class="card mb-3">
        <div class="card-header">天气</div>
        <div class="card-body" id="weather">加载中...</div>
      </div>
    </aside>
  </div>
</main>
<footer class="bg-dark text-white py-3 mt-4">
  <div class="container d-flex justify-content-between">
    <div>© <span id="year"></span> 我的博客</div>
    <div id="time"></div>
  </div>
</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
(function(){
  try{
    var yearEl = document.getElementById('year');
    if(yearEl){ yearEl.textContent = new Date().getFullYear(); }
    setInterval(function(){ var t=document.getElementById('time'); if(t){ t.textContent = new Date().toLocaleString(); } }, 1000);
    const dailyCounts = {{ .dailyCountsJSON }};
    function renderCalendar(el){
      const d = new Date();
      const year = d.getFullYear(), month = d.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const days = new Date(year, month+1, 0).getDate();
      let html = '<table class="table table-sm"><thead><tr><th colspan="7" class="text-center">'+year+'年'+(month+1)+'月</th></tr><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead><tbody><tr>';
      for(let i=0;i<firstDay;i++) html += '<td></td>';
      let day=1, dow=firstDay;
      while(day<=days){
        const key = year+'-'+String(month+1).padStart(2,'0')+'-'+String(day).padStart(2,'0');
        const cnt = dailyCounts[key]||0;
        const badge = cnt>0?(' <span class=\"badge bg-info text-dark\">'+cnt+'</span>'):'';
        html += '<td>'+day+badge+'</td>';
        day++; dow++;
        if(dow===7 && day<=days){ html += '</tr><tr>'; dow=0; }
      }
      html += '</tr></tbody></table>';
      el.innerHTML = html;
    }
    var cal = document.getElementById('calendar'); if(cal){ renderCalendar(cal); }
    async function loadWeather(){
      try{
        const url = 'https://api.open-meteo.com/v1/forecast?latitude=39.9042&longitude=116.4074&current=temperature_2m,weathercode&daily=temperature_2m_max,temperature_2m_min&timezone=auto';
        const res = await fetch(url);
        const data = await res.json();
        const cur = data.current;
        const daily = data.daily;
        var w = document.getElementById('weather');
        if(w){ w.innerHTML = '当前温度：'+cur.temperature_2m+'°C<br>今日最高/最低：'+daily.temperature_2m_max[0]+'°C / '+daily.temperature_2m_min[0]+'°C'; }
      }catch(e){
        var w = document.getElementById('weather'); if(w){ w.textContent = '天气服务不可用'; }
      }
    }
    var w = document.getElementById('weather'); if(w){ loadWeather(); }
  }catch(e){}
})();
</script>
</body>
</html>
{{ end }}
