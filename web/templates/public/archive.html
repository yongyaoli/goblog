{{ define "public/archive.html" }}
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>归档</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="d-flex flex-column min-vh-100">
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand" href="/">{{ if .siteTitle }}{{ .siteTitle }}{{ else }}我的博客{{ end }}</a>
  </div>
</nav>
<main class="container py-4 flex-grow-1">
  <div class="row">
    <div class="col-lg-8">
      <h1>归档</h1>
      <ul class="list-group">
        {{ range .items }}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <a href="/post/{{ .Slug }}">{{ .Title }}</a>
          <span class="text-muted">{{ .Month }}</span>
        </li>
        {{ end }}
      </ul>
    </div>
    <aside class="col-lg-4">
      <div class="card mb-3">
        <div class="card-header">标签</div>
        <div class="card-body">
          {{ range .tags }}
          <a href="/tags/{{ .Name }}" class="badge bg-info text-dark text-decoration-none me-1 mb-1">{{ .Name }}</a>
          {{ end }}
        </div>
      </div>
      <div class="card mb-3">
        <div class="card-header">分类</div>
        <ul class="list-group list-group-flush">
          {{ range .categories }}
          <li class="list-group-item"><a href="/categories/{{ .Slug }}">{{ .Title }}</a></li>
          {{ end }}
        </ul>
      </div>
      <div class="card mb-3">
        <div class="card-header">本月日历</div>
        <div class="card-body" id="calendar"></div>
      </div>
      <div class="card mb-3">
        <div class="card-header">天气</div>
        <div class="card-body" id="weather">加载中...</div>
      </div>
    </aside>
  </div>
</main>
<footer class="bg-dark text-white py-3 mt-auto">
  <div class="container">
    <div class="row">
      <div class="col-md-8">
        {{ if .friendLinks }}
        <div class="mb-2">
          <span class="me-2">友情链接：</span>
          {{ range .friendLinks }}
          <a href="{{ .URL }}" class="link-light me-2" target="_blank" rel="noopener">{{ .Name }}</a>
          {{ end }}
        </div>
        {{ end }}
        <div>
          © <span id="year"></span>
          {{ if .siteTitle }} {{ .siteTitle }}{{ else }} 我的博客{{ end }}
          {{ if .siteCopyright }} {{ .siteCopyright }}{{ end }}
          {{ if .siteICP }} | {{ .siteICP }}{{ end }}
        </div>
      </div>
      <div class="col-md-4 text-md-end mt-2 mt-md-0">
        <div id="time"></div>
      </div>
    </div>
  </div>
</footer>
<script>
(function(){
  try{
    const dailyCounts = {{ .dailyCountsJSON }};
    function renderCalendar(el){
      const d = new Date();
      const year = d.getFullYear(), month = d.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const days = new Date(year, month+1, 0).getDate();
      let html = '<table class="table table-sm"><thead><tr><th colspan="7" class="text-center">'+year+'年'+(month+1)+'月</th></tr><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead><tbody><tr>';
      for(let i=0;i<firstDay;i++) html += '<td></td>';
      let day=1, dow=firstDay;
      while(day<=days){
        const key = year+'-'+String(month+1).padStart(2,'0')+'-'+String(day).padStart(2,'0');
        const cnt = dailyCounts[key]||0;
        const badge = cnt>0?(' <span class="badge bg-info text-dark">'+cnt+'</span>'):'';
        html += '<td>'+day+badge+'</td>';
        day++; dow++;
        if(dow===7 && day<=days){ html += '</tr><tr>'; dow=0; }
      }
      html += '</tr></tbody></table>';
      el.innerHTML = html;
    }
    var cal = document.getElementById('calendar'); if(cal){ renderCalendar(cal); }
    async function loadWeather(){
      try{
        const url = 'https://api.open-meteo.com/v1/forecast?latitude=39.9042&longitude=116.4074&current=temperature_2m,weathercode&daily=temperature_2m_max,temperature_2m_min&timezone=auto';
        const res = await fetch(url);
        const data = await res.json();
        const cur = data.current;
        const daily = data.daily;
        var w = document.getElementById('weather');
        if(w){ w.innerHTML = '当前温度：'+cur.temperature_2m+'°C<br>今日最高/最低：'+daily.temperature_2m_max[0]+'°C / '+daily.temperature_2m_min[0]+'°C'; }
      }catch(e){
        var w = document.getElementById('weather'); if(w){ w.textContent = '天气服务不可用'; }
      }
    }
    var w = document.getElementById('weather'); if(w){ loadWeather(); }
  }catch(e){}
})();
</script>
<script>
(function(){
  var y=document.getElementById('year'); if(y){ y.textContent=new Date().getFullYear(); }
  var t=document.getElementById('time'); if(t){ setInterval(function(){ t.textContent=new Date().toLocaleString(); },1000); }
})();
</script>
</body>
</html>
{{ end }}
