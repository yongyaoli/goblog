{{ define "admin/menus.html" }}
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>菜单管理</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
{{ template "admin/navbar" . }}
 <main class="container py-4">
  <h3>菜单管理</h3>
  <div class="row g-2 mb-3">
    <div class="col"><input id="title" class="form-control" placeholder="菜单名"></div>
    <div class="col"><input id="path" class="form-control" placeholder="链接地址"></div>
    <div class="col"><input id="icon" class="form-control" placeholder="图标类名（可选）"></div>
    <div class="col"><input id="order" class="form-control" placeholder="排序（数字）" type="number" value="0"></div>
    <div class="col"><input id="parent_id" class="form-control" placeholder="父菜单ID（可选）" type="number"></div>
    <div class="col-auto"><button class="btn btn-primary" id="add">添加</button></div>
  </div>
  <table class="table">
    <thead><tr><th>ID</th><th>菜单名</th><th>链接</th><th>父ID</th><th>排序</th><th>操作</th></tr></thead>
    <tbody id="list"></tbody>
  </table>
 </main>
 <script>
 ;(function(){
   const btn = document.getElementById('logoutBtn');
   if(btn){
     btn.onclick = async function(){
       const token = localStorage.getItem('token');
       try{
         await fetch('/api/admin/logout', {method:'POST', headers: token ? {Authorization:'Bearer '+token} : {}});
       }catch(e){}
       localStorage.removeItem('token');
       location.href = '/admin';
     };
   }
 })();
 const token = localStorage.getItem('token');
 async function load(){
   const res = await fetch('/api/admin/menus', {headers:{Authorization:'Bearer '+token}});
   const data = await res.json();
   const tbody = document.getElementById('list'); tbody.innerHTML='';
   for(const it of data.items){
     const tr = document.createElement('tr');
     tr.innerHTML = `<td>${it.ID}</td><td>${it.Title}</td><td>${it.Path||''}</td><td>${it.ParentID||''}</td><td>${it.Order||0}</td>
     <td><button class="btn btn-sm btn-danger" data-del="${it.ID}">删除</button></td>`;
     tbody.appendChild(tr);
   }
 }
 document.getElementById('add').onclick = async ()=>{
   const fd = new FormData();
   fd.set('title', document.getElementById('title').value.trim());
   fd.set('path', document.getElementById('path').value.trim());
   fd.set('icon', document.getElementById('icon').value.trim());
   fd.set('order', document.getElementById('order').value.trim());
   const pid = document.getElementById('parent_id').value.trim();
   if(pid) fd.set('parent_id', pid);
   await fetch('/api/admin/menus', {method:'POST', headers:{Authorization:'Bearer '+token}, body: fd});
   document.getElementById('title').value=''; document.getElementById('path').value=''; document.getElementById('icon').value='';
   document.getElementById('order').value='0'; document.getElementById('parent_id').value='';
   load();
 };
 document.addEventListener('click', async (e)=>{
   if(e.target && e.target.dataset && e.target.dataset.del){
     const id = e.target.dataset.del;
     await fetch('/api/admin/menus/'+id, {method:'DELETE', headers:{Authorization:'Bearer '+token}});
     load();
   }
 });
 load();
 </script>
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
 </body>
 </html>
{{ end }}
